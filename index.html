<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Mini Shooter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC1FhFMFEFChjENC3gp8fPM-06jKSn86w",
  authDomain: "minishooter.firebaseapp.com",
  databaseURL: "https://minishooter-default-rtdb.firebaseio.com",
  projectId: "minishooter",
  storageBucket: "minishooter.appspot.com",
  messagingSenderId: "363773533175",
  appId: "1:363773533175:web:d41377d66730ff7ca2ecf2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();
</script>

<style>
body {
  margin: 0;
  background: #111;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}

.wrapper {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 20px;
  flex-wrap: wrap;
}

canvas {
  background: black;
  border: 2px solid white;
}

.panel {
  width: 260px;
  background: #000;
  border: 2px solid red;
  padding: 10px;
}

button {
  width: 100%;
  padding: 6px;
  background: #222;
  color: white;
  border: 1px solid white;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>üî´ Mini Shooter</h1>

<div class="wrapper">

  <!-- HRA -->
  <div>
    <canvas id="game" width="400" height="600"></canvas>
    <p>A / D ‚Ä¢ klik = st≈ôelba</p>
    <p>Sk√≥re: <span id="score">0</span></p>
  </div>

  <!-- LEADERBOARD -->
  <div class="panel">
    <h2>üèÜ Global Leaderboard</h2>
    <button id="loginBtn">P≈ôihl√°sit se p≈ôes Google</button>
    <p id="authStatus">Nep≈ôihl√°≈°en</p>
    <div id="leaderboard"></div>
  </div>

</div>

<script>
/* ===== AUTH ‚Äì OPRAVEN√â TLAƒå√çTKO ===== */
const loginBtn = document.getElementById("loginBtn");
const authStatus = document.getElementById("authStatus");
const provider = new firebase.auth.GoogleAuthProvider();

loginBtn.addEventListener("click", () => {
  // 1Ô∏è‚É£ zkus popup
  auth.signInWithPopup(provider).catch(err => {
    console.warn("Popup selhal, jedu redirect", err);
    // 2Ô∏è‚É£ fallback na redirect
    auth.signInWithRedirect(provider);
  });
});

auth.onAuthStateChanged(user => {
  if (user) {
    authStatus.textContent = "P≈ôihl√°≈°en: " + user.displayName;
    loginBtn.style.display = "none";
  } else {
    authStatus.textContent = "Nep≈ôihl√°≈°en";
    loginBtn.style.display = "block";
  }
});

/* ===== LEADERBOARD ===== */
function saveScore(score) {
  const user = auth.currentUser;
  if (!user) return;

  const ref = db.ref("leaderboard/" + user.uid);
  ref.get().then(snap => {
    if (!snap.exists() || score > snap.val().score) {
      ref.set({ name: user.displayName, score });
    }
  });
}

db.ref("leaderboard")
  .orderByChild("score")
  .limitToLast(10)
  .on("value", snap => {
    const lb = document.getElementById("leaderboard");
    lb.innerHTML = "";
    if (!snap.exists()) return;

    Object.values(snap.val())
      .sort((a,b)=>b.score-a.score)
      .forEach((p,i)=>{
        lb.innerHTML += `<div>${i+1}. ${p.name} (${p.score})</div>`;
      });
  });

/* ===== HRA ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");

let score = 0;
let lives = 20;
let gameOver = false;

const player = { x:180, y:520, w:40, h:40, s:7 };
let bullets = [];
let enemies = [];
let keys = {};
let timer = 0;

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

canvas.addEventListener("mousedown", () => {
  if (gameOver) restart();
  else bullets.push({ x:player.x+18, y:player.y, s:10 });
});

function restart() {
  score = 0;
  lives = 20;
  bullets = [];
  enemies = [];
  gameOver = false;
  scoreEl.textContent = score;
}

function spawnEnemy() {
  enemies.push({
    x: Math.random()*360,
    y: -40,
    w: 40,
    h: 40,
    s: 1   // üëà ZPOMALENO (bylo 2‚Äì3)
  });
}

function update() {
  if (gameOver) return;

  if (keys["a"] && player.x>0) player.x -= player.s;
  if (keys["d"] && player.x<360) player.x += player.s;

  bullets.forEach(b=>b.y-=b.s);
  bullets = bullets.filter(b=>b.y>-10);

  enemies.forEach(e=>e.y+=e.s);

  timer++;
  if (timer>150){ spawnEnemy(); timer=0; } // üëà m√©nƒõ ƒçasto

  enemies.forEach((e,ei)=>{
    // kolize s hr√°ƒçem
    if (
      e.x < player.x + player.w &&
      e.x + e.w > player.x &&
      e.y < player.y + player.h &&
      e.y + e.h > player.y
    ) {
      enemies.splice(ei,1);
      lives--;
    }

    bullets.forEach((b,bi)=>{
      if (
        b.x < e.x + e.w &&
        b.x + 4 > e.x &&
        b.y < e.y + e.h &&
        b.y + 10 > e.y
      ) {
        enemies.splice(ei,1);
        bullets.splice(bi,1);
        score++;
        scoreEl.textContent = score;
      }
    });

    if (e.y > 600) {
      enemies.splice(ei,1);
      lives--;
    }
  });

  if (lives <= 0) {
    gameOver = true;
    saveScore(score);
  }
}

function draw() {
  ctx.clearRect(0,0,400,600);

  ctx.fillStyle="lime";
  ctx.fillRect(player.x,player.y,player.w,player.h);

  ctx.fillStyle="yellow";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,4,10));

  ctx.fillStyle="red";
  enemies.forEach(e=>ctx.fillRect(e.x,e.y,e.w,e.h));

  // ‚ù§Ô∏è ≈æivoty
  ctx.fillStyle="white";
  ctx.textAlign="right";
  ctx.font="16px Arial";
  ctx.fillText(`‚ù§Ô∏è ${lives}/20`,390,20);

  if (gameOver) {
    ctx.fillStyle="rgba(0,0,0,0.7)";
    ctx.fillRect(60,200,280,200);
    ctx.strokeStyle="white";
    ctx.strokeRect(60,200,280,200);
    ctx.fillStyle="white";
    ctx.textAlign="center";
    ctx.font="28px Arial";
    ctx.fillText("GAME OVER",200,260);
    ctx.font="16px Arial";
    ctx.fillText("Klik pro restart",200,300);
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
