<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Mini Shooter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<!-- üî• FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC1FhFMFEFChjENC3gp8fPM-06jKSN86w",
  authDomain: "minishooter.firebaseapp.com",
  databaseURL: "https://minishooter-default-rtdb.firebaseio.com",
  projectId: "minishooter",
  storageBucket: "minishooter.appspot.com",
  messagingSenderId: "363773533175",
  appId: "1:363773533175:web:d41377d66730ff7ca2ecf2"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
</script>

<style>
body {
  margin: 0;
  background: #111;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}

.wrapper {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 20px;
  flex-wrap: wrap;
}

canvas {
  background: black;
  border: 2px solid white;
  touch-action: none;
}

.panel {
  width: 260px;
  background: #000;
  border: 2px solid red;
  padding: 10px;
}

button {
  width: 100%;
  padding: 6px;
  background: #222;
  color: white;
  border: 1px solid white;
  cursor: pointer;
}

table {
  width: 100%;
  margin-top: 10px;
  border-collapse: collapse;
}

td {
  padding: 4px;
  text-align: left;
}
</style>
</head>

<body>

<h1>üî´ Mini Shooter</h1>

<div class="wrapper">

  <div>
    <canvas id="game" width="400" height="600"></canvas>
    <p>A / D nebo üì± dotyk ‚Ä¢ klik / tap = st≈ôelba</p>
    <p>Sk√≥re: <span id="score">0</span></p>
  </div>

  <div class="panel">
    <h2>üèÜ Global Leaderboard</h2>
    <button onclick="login()">P≈ôihl√°sit se Googlem</button>
    <p id="playerName">Nep≈ôihl√°≈°en</p>
    <table id="leaderboard"></table>
  </div>

</div>

<script>
/* ===== AUTH ===== */
let user = null;
const playerNameEl = document.getElementById("playerName");

function login() {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).catch(e => alert(e.message));
}

auth.onAuthStateChanged(u => {
  user = u;
  playerNameEl.textContent = u
    ? "P≈ôihl√°≈°en: " + u.displayName
    : "Nep≈ôihl√°≈°en";
});

/* ===== LEADERBOARD ===== */
const leaderboardEl = document.getElementById("leaderboard");

function saveGlobalScore(score) {
  if (!user) return;

  const ref = db.ref("leaderboard/" + user.uid);
  ref.get().then(snap => {
    if (!snap.exists() || score > snap.val().score) {
      ref.set({
        name: user.displayName,
        score: score
      });
    }
  });
}

function loadGlobalLeaderboard() {
  db.ref("leaderboard")
    .orderByChild("score")
    .limitToLast(10)
    .on("value", snap => {
      leaderboardEl.innerHTML = "";
      if (!snap.val()) return;

      Object.values(snap.val())
        .sort((a, b) => b.score - a.score)
        .forEach((p, i) => {
          leaderboardEl.innerHTML +=
            `<tr><td>${i + 1}. ${p.name} (${p.score})</td></tr>`;
        });
    });
}
loadGlobalLeaderboard();

/* ===== HRA ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");

let score = 0;
let lives = 20;
let gameOver = false;

const player = { x: 180, y: 520, s: 8 };
let bullets = [];
let enemies = [];
let keys = {};
let timer = 0;
let touchLeft = false, touchRight = false;

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

canvas.addEventListener("mousedown", () => {
  gameOver ? restart() : bullets.push({ x: player.x + 18, y: player.y });
});

canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  const x = e.touches[0].clientX;
  x < window.innerWidth / 2 ? touchLeft = true : touchRight = true;
  gameOver ? restart() : bullets.push({ x: player.x + 18, y: player.y });
}, { passive: false });

canvas.addEventListener("touchend", () => touchLeft = touchRight = false);

function restart() {
  score = 0;
  lives = 20;
  gameOver = false;
  bullets = [];
  enemies = [];
  scoreEl.textContent = 0;
}

function spawn() {
  enemies.push({ x: Math.random() * 360, y: -40 });
}

function update() {
  if (gameOver) return;

  if ((keys.a || touchLeft) && player.x > 0) player.x -= player.s;
  if ((keys.d || touchRight) && player.x < 360) player.x += player.s;

  bullets.forEach(b => b.y -= 10);
  bullets = bullets.filter(b => b.y > -10);

  enemies.forEach(e => e.y += 1);

  if (++timer > 180) { spawn(); timer = 0; }

  enemies.forEach((e, ei) => {
    if (e.y > 600) { enemies.splice(ei, 1); lives--; }

    bullets.forEach((b, bi) => {
      if (
        b.x < e.x + 40 && b.x + 4 > e.x &&
        b.y < e.y + 40 && b.y + 10 > e.y
      ) {
        enemies.splice(ei, 1);
        bullets.splice(bi, 1);
        score++;
        scoreEl.textContent = score;
      }
    });

    if (
      e.x < player.x + 40 && e.x + 40 > player.x &&
      e.y < player.y + 40 && e.y + 40 > player.y
    ) {
      enemies.splice(ei, 1);
      lives--;
    }
  });

  if (lives <= 0) {
    gameOver = true;
    saveGlobalScore(score);
  }
}

function draw() {
  ctx.clearRect(0, 0, 400, 600);

  ctx.fillStyle = "lime";
  ctx.fillRect(player.x, player.y, 40, 40);

  ctx.fillStyle = "yellow";
  bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 10));

  ctx.fillStyle = "red";
  enemies.forEach(e => ctx.fillRect(e.x, e.y, 40, 40));

  ctx.fillStyle = "white";
  ctx.fillText("‚ù§Ô∏è " + lives + "/20", 320, 20);

  if (gameOver) {
    ctx.fillStyle = "rgba(0,0,0,.7)";
    ctx.fillRect(60, 200, 280, 200);
    ctx.strokeStyle = "white";
    ctx.strokeRect(60, 200, 280, 200);
    ctx.fillStyle = "white";
    ctx.textAlign = "center";
    ctx.font = "28px Arial";
    ctx.fillText("GAME OVER", 200, 260);
    ctx.font = "16px Arial";
    ctx.fillText("Klik / tap pro restart", 200, 300);
  }
}

(function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
})();
</script>

</body>
</html>
